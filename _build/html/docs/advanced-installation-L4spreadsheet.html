
<!DOCTYPE html>

<html lang="en">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Compiling an Edited L4 Spreadsheet | L4  documentation</title>
<link href="../_static/pygments.css" rel="stylesheet"/>
<link href="../_static/theme.9297a650d9dd3016d913.css" rel="stylesheet"/>
<link href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" rel="stylesheet"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="early-beta.html" rel="next" title="Early Beta"/>
<link href="advanced-installation-googlesheets.html" rel="prev" title="Google Sheets Setup Intructions"/>
</head>
<body class="antialiased text-gray scroll-smooth">
<div class="min-h-screen xl:h-screen flex flex-col xl:grid xl:grid-layout print:block print:h-auto" data-action="keydown@window-&gt;search#focus " data-controller="sidebar search " id="page">
<a class="block transition -translate-x-full focus:translate-x-0 opacity-0 focus:opacity-100 text-xl bg-white p-4 z-20 absolute top-0 left-0 h-14" href="#compiling-an-edited-l4-spreadsheet" title="Skip navigation links">Skip to content</a>
<header class="grid-area-header z-10 h-14 fixed w-full top-0 print:hidden">
<div class="bg-gray-dark shadow-md flex items-center h-full xl:px-2 relative"><div class="flex items-center">
<button class="xl:hidden h-14 w-14 leading-14 text-gray-100 hover:bg-gray-700 hover:text-brand focus:outline-none focus:bg-gray-700 focus:text-brand" data-action="sidebar#open" data-sidebar-target="hamburger">
<span class="sr-only">Open navigation menu</span>
<svg aria-hidden="true" class="fill-current h-8 w-8" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg>
</button><a class="hover:bg-gray-700 focus:bg-gray-700 focus:outline-none" href="../index.html" title="Back to homepage"><span class="hidden lg:inline-block shrink-0 font-medium text-gray-100 mx-5 leading-14 tracking-wider">L4  documentation</span>
</a></div><div class="flex justify-end items-center flex-1"><form action="../search.html" class="flex print:hidden justify-between items-center leading-14 md:ml-4 bg-gray-dark text-gray-300 focus-within:bg-gray-50 focus-within:text-gray-800 focus-within:absolute focus-within:inset-x-0 focus-within:top-0 md:focus-within:w-full md:focus-within:static z-10" data-action="click-&gt;search#focusSearchInput" id="searchbox" method="get">
<button aria-label="Get search results" class="text-inherit h-14 w-14" tabindex="-1">
<svg aria-hidden="true" class="fill-current stroke-current h-8 w-8" stroke-width="0.5" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
</button>
<input aria-label="Search the docs" class="pr-2 bg-transparent text-inherit focus:outline-none w-0 md:w-auto focus:w-full transition-all duration-100" data-search-target="searchInput" id="search-input" name="q" placeholder="Search the docs" type="search"/>
</form></div>
</div>
</header>
<aside class="grid-area-sidebar h-full fixed pt-14 xl:relative inset-y-0 left-0 z-20 xl:z-0 print:hidden overflow-y-auto transition-all transform transform-gpu -translate-x-full opacity-0 duration-300 xl:translate-x-0 xl:opacity-100" data-sidebar-target="sidebar">
<nav class="h-full overflow-y-auto bg-white text-gray-600 pt-8 flex flex-col" role="navigation">
<div class="nav-toc flex-1 pl-6"><p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="quickstart-tour-of-L4.html">Tour of L4</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="quickstart-installation.html">Getting Started</a></div></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Returning Users</span></p>
<ul>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-examples.html">Examples</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-L4-and-law.html">L4 Approaches to the Law</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-cheatsheet.html">Cheatsheet</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-cheatsheet.html#syntax-reference-by-keyword">Syntax Reference by Keyword</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-exporting-L4.html">Exporting L4</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-exercises.html">Exercises</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-keywords.html">Language Specification</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-law-logic-programming.html">Law and Logic programming</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-flowchart.html">Flowcharts and Software Engineering</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-common-expressions.html">Computer Science terms in L4</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="returning-computational-law.html">L4 and Computational Law</a></div></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Setting up the L4 Backend</span></p>
<ul class="current">
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="advanced-explanations.html">Conceptual Explanation of the Backend</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="advanced-security.html">Security Considerations</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="advanced-installation-webtool.html">Webtool Setup Instructions</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="advanced-installation-googlesheets.html">Google Sheets Setup Intructions</a></div></li>
<li class="toctree-l1 current expanded"><div class="nav-link"><a class="current reference internal" data-action="click-&gt;sidebar#close" href="#">Compiling an Edited L4 Spreadsheet</a></div></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Early Beta and Acknowledgements</span></p>
<ul>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="early-beta.html">Early Beta</a></div></li>
<li class="toctree-l1"><div class="nav-link"><a class="reference internal" data-action="click-&gt;sidebar#close" href="acknowledgements.html">Acknowledgements</a></div></li>
</ul>
</div>
<button class="text-4xl text-gray-800 p-4 bottom-0 hover:text-brand xl:hidden focus:text-brand self-center" data-action="sidebar#close" title="Close navigation menu">
<span class="sr-only">Close navigation menu</span>
<svg aria-hidden="true" class="fill-current stroke-current h-6 w-6" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</aside>
<main class="px-4 pt-14 xl:ml-fluid grid-area-main overflow-y-auto flex flex-col flex-1 h-full mx-0 md:mx-auto xl:mr-0"><nav aria-label="breadcrumbs" class="print:hidden mt-12 text-sm text-gray-light" role="navigation">
<a class="text-gray-light text-sm hover:text-gray-dark font-medium focus:text-gray-dark" href="../index.html">L4  documentation</a>
<span class="mr-1">/</span><span aria-current="page">Compiling an Edited L4 Spreadsheet</span>
</nav>
<article class="flex-1" role="main">
<section id="compiling-an-edited-l4-spreadsheet">
<span id="auto-config"></span><h1>Compiling an Edited L4 Spreadsheet<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#compiling-an-edited-l4-spreadsheet">¶</a></h1>
<p>This section is only required if you want to edit the L4 Spreadsheet and compile a new version of the web app out of this edited L4 Spreadsheet.</p>
<section id="automatic-configuration-of-the-web-tool">
<h2>Automatic configuration of the Web Tool<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#automatic-configuration-of-the-web-tool">¶</a></h2>
<p>The following code block shows a launch and run of the hello.py script by way of gunicorn, detailed in section <a class="reference internal" href="advanced-explanations.html#gunicorn"><span class="std std-ref">hello.py is managed by gunicorn</span></a> This run shows hello.py calling natural4-exe and v8k, each detailed below.</p>
<div class="code-wrapper" data-controller="code">
<div class="code-header">
<span class="code-lang">default</span></div>
<div class="highlight"><pre><code>$ gunicorn --certfile /etc/letsencrypt/live/cclaw.legalese.com/cert.pem --keyfile /etc/letsencrypt/live/cclaw.legalese.com/privkey.pem --workers=5 --bind 0.0.0.0:8081 --pythonpath /home/mengwong/pyrest/lib/python3.8/site-packages/ wsgi:app
</code></pre></div></div>
<p>The command-line arguments will need to be adapted to the circumstances of your local development environment. In particular, the pythonpath option may be omitted or customized to match your Python installation. See section <a class="reference internal" href="advanced-explanations.html#gunicorn"><span class="std std-ref">hello.py is managed by gunicorn</span></a> for details.</p>
<section id="installing-the-l4-interpreter-natural4-exe">
<h3>Installing the L4 interpreter: natural4-exe<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#installing-the-l4-interpreter-natural4-exe">¶</a></h3>
<p>This subsubsection is only required if you need to edit the web tool. You might want to edit the web tool if, for example, the law changes and you need to update content. If you are happy with the web tool as it is, you may skip this section.</p>
<p>The interpreter for Natural L4 is contained in the natural4-exe executable, whose source code is available at
<a class="reference external" href="https://github.com/smucclaw/dsl/tree/main/lib/haskell/natural4" rel="nofollow noopener">https://github.com/smucclaw/dsl/tree/main/lib/haskell/natural4<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a></p>
<p>Contact the L4 developers for a ZIP file containing natural4-exe executables compiled for the following platforms:
- Linux
- MacOS
- Windows</p>
<p>The executable may be recompiled from source. While the codebase is written in Haskell, no expertise in Haskell is required, beyond installing and running the “Stack” package manager and build tool <a class="footnote-reference brackets" href="#f1" id="id1">1</a>. The stack tool plays roughly the same role for Haskell that pip does for Python and npm does for Javascript. Detailed build and install instructions are available in the Github repository above.</p>
</section>
</section>
<section id="purescript-configuration">
<h2>Purescript configuration<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#purescript-configuration">¶</a></h2>
<p>Generation of the Purescript output file is described in the previous section.</p>
<p>To become part of the running web app which is linked from the sidebar, the Purescript output file needs to be copied into the source tree of the Web Tool at src/RuleLib/PDPADBNO.purs. The helper script v8k available at vue-pure-pdpa/bin/v8k performs this function automatically when called by the hello.py script.</p>
<p>The back-end of the Web Tool consumes that file as content and configuration, which controls the Web Tool’s interactive Q&amp;A front end user interface.</p>
</section>
<section id="maintaining-vue">
<h2>Maintaining vue<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#maintaining-vue">¶</a></h2>
<p>The Vue web tool distributed above originates in the smucclaw/vue-pure-pdpa repository. If it is necessary to update or upgrade the package, the above repository should be used as the main “working directory”, then changes should be synced downstream to the vue-big and vue-small copies.</p>
<p>Updates involving npm should be performed as far upstream as possible, meaning in vue-big, and then reflected out to the vue-small and vue-NN copies (through the symlink and the rsync respectively), to minimize the build times incurred by npm run serve.</p>
</section>
<section id="the-l4-spreadsheet-can-choose-a-backend-port">
<h2>The L4 spreadsheet can choose a backend port<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#the-l4-spreadsheet-can-choose-a-backend-port">¶</a></h2>
<p>In the L4 spreadsheet, a commented-out line at the top of the spreadsheet can contain two adjacent cells containing “devMode port” and “8081”. That will instruct pathsCode.gs to access the Pyrest endpoints on port 8081 of the backend server. If that instruction is not present, the default port is 8080.</p>
</section>
<section id="https-is-needed-letsencrypt-refreshes-certificates">
<span id="https-needed"></span><h2>Https is needed; letsencrypt refreshes certificates<a aria-label="Click to copy this link" class="headerlink tooltipped tooltipped-ne" data-action="click-&gt;clipboard#copyHeaderLink" data-controller="clipboard" href="#https-is-needed-letsencrypt-refreshes-certificates">¶</a></h2>
<p>Both the Web Tool and gunicorn/hello.py need to be made aware of the SSL certificate paths.</p>
<p>gunicorn is given those paths on the command line, as seen in section <a class="reference internal" href="advanced-explanations.html#gunicorn"><span class="std std-ref">hello.py is managed by gunicorn</span></a> above.</p>
<p>The vue system is given those paths in <code class="docutils literal notranslate">$V8K_WORKDIR/vue-xx/vue.config.js</code>:</p>
<div class="code-wrapper" data-controller="code">
<div class="code-header">
<span class="code-lang">default</span></div>
<div class="highlight"><pre><code>┌─[20221102-23:34:05]   [mengwong@cclaw:~/wow/much/vue-04]
└─[0] &lt;git:(main 89d183a✱✈) &gt; grep -1 letsencrypt vue.config.js
    https: {
    key:  fs.readFileSync('/etc/letsencrypt/live/cclaw.legalese.com/privkey.pem'),
    cert: fs.readFileSync('/etc/letsencrypt/live/cclaw.legalese.com/cert.pem')
    }
</code></pre></div></div>
<p>To run this system locally you will need to bring up SSL certificates for your own domain name. One popular SSL provider is <a class="reference external" href="https://letsencrypt.org/" rel="nofollow noopener">https://letsencrypt.org/<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a></p>
<p>Google Apps Script refuses to load image assets in the sidebar if those assets are not retrieved via https. To serve https on the backend server, pick a domain name under your control and set up an SSL certificate for that domain name.</p>
<p>Configure DNS to point that domain name at your backend server. In our implementation we used Let’s Encrypt to set up and auto-refresh the SSL certificate. The files are saved under the /etc/letsencrypt directory.</p>
<p>We relied on DNS resources kindly provided by industry partner Legalese.com to set up SSL certificates at the domain cclaw.legalese.com. We do not have DNS control of the Amazon AWS hostname, meaning that we have to use the cclaw.legalese.com hostname.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>available at <a class="reference external" href="https://www.haskellstack.org/" rel="nofollow noopener">https://www.haskellstack.org/<svg aria-hidden="true" class="external-link-icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path></svg></a></p>
</dd>
</dl>
</section>
</section>
</article>
<footer>
<div class="mt-20 mb-4 text-sm text-gray-700 print:mt-4">© 2023, Meng Weng Wong Made with <a href="https://www.sphinx-doc.org">Sphinx 5.3.0</a></div>
</footer></main>
<button class="fixed bottom-0 right-0 z-20 opacity-0 p-4 m-4 tracking-wide bg-gray-900 text-gray-100 transition transform transform-gpu duration-500 translate-y-full" data-action="search#hideSnackbar" data-search-target="snackbar">
  Clear highlights
</button><div class="fixed hidden inset-0 bg-black bg-opacity-50" data-action="click-&gt;sidebar#close" data-sidebar-target="screen">
</div>
</div>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/sphinx_highlight.js"></script>
<script src="../_static/design-tabs.js"></script>
<script src="../_static/theme.3051a0ec24cad00d4d88.js"></script>
</body>
</html>